<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Parameter constraints · GModelFit.jl</title><meta name="title" content="Parameter constraints · GModelFit.jl"/><meta property="og:title" content="Parameter constraints · GModelFit.jl"/><meta property="twitter:title" content="Parameter constraints · GModelFit.jl"/><meta name="description" content="Documentation for GModelFit.jl."/><meta property="og:description" content="Documentation for GModelFit.jl."/><meta property="twitter:description" content="Documentation for GModelFit.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">GModelFit.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../concepts/">Data types and functionalities</a></li><li><a class="tocitem" href="../builtincomp/">Built-in components</a></li><li><a class="tocitem" href="../customcomp/">Custom components</a></li><li class="is-active"><a class="tocitem" href>Parameter constraints</a></li><li><a class="tocitem" href="../multifit/">Multi-dataset fitting</a></li><li><a class="tocitem" href="../minimizers/">Minimizers</a></li><li><a class="tocitem" href="../misc/">Miscellaneous</a></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Parameter constraints</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Parameter constraints</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/gcalderone/GModelFit.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/gcalderone/GModelFit.jl/blob/master/docs/src/parameter.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Parameter-constraints"><a class="docs-heading-anchor" href="#Parameter-constraints">Parameter constraints</a><a id="Parameter-constraints-1"></a><a class="docs-heading-anchor-permalink" href="#Parameter-constraints" title="Permalink"></a></h1><p>Models are characterized by <em>parameters</em> (see <a href="../concepts/#Basic-concepts-and-data-types">Basic concepts and data types</a>) whose values are modified during fitting until a convergence criterion is met, and the <em>best fit</em> values are identified.  In many cases, however, the parameters can not vary arbitrarily but should satisfy some constraints for their values to be meaningful.  <strong>GModelFit.jl</strong> supports the definition of constraints by fixing the parameter to a specific value, limiting the value in a user defined range, or by dynamically calculating its value using a mathematical expression involving other parameter values.  In the latter case the parameter is not free to vary in the fit since its actual value is determined by the patch constraint, hence it is dubbed a <em>patched</em> parameter.  Such unused parameter can optionally be repurposed as a new free parameter in a <em>parametrized patch expression</em> (see example below).</p><p>An important concept to bear in mind is that the <a href="../api/#GModelFit.Parameter"><code>GModelFit.Parameter</code></a> structure provides two field for the associated numerical value:</p><ul><li><code>val</code>: is the parameter value which is being varied by the minimizer during fitting.  The value set before the fitting is the <em>guess</em> value.  The value after fitting is the <em>best fit</em> one;</li><li><code>actual</code>: is the result of the patch expression evaluation, and the actual value used when evaluating a component via its <code>evaluate!</code> method.  Note that this value will be overwitten at each model evaluation, hence setting this field has no effect. The <code>val</code> and <code>actual</code> values are identical if no patch constraint has been defined.</li></ul><p>A parameter constraint is defined by explicitly modifiying the fields of the corresponding <a href="../api/#GModelFit.Parameter"><code>GModelFit.Parameter</code></a> structure. More specifically:</p><ol><li>to set a parameter to a specific value: set the <code>val</code> field to the numeric value and set the <code>fixed</code> field to <code>true</code>;</li><li>to set a parameter value range: set one or both the <code>low</code> and <code>high</code> fields (default values are <code>-Inf</code> and <code>+Inf</code> respectively);</li><li>to constraint a parameter to have the same numerical value as another one with the same name (but in another component): set the <code>patch</code> value to the component name (it must be a <code>Symbol</code>);</li><li>to dynamically calculate an <code>actual</code> value using a mathematical expression depending on other parameter values: set the <code>patch</code> field to an anonymous function generated with the <a href="../api/#GModelFit.@fd"><code>@fd</code></a> macro.  The function must accept a single argument (actually a dictionary of components) and return a scalar numberl;</li><li>to define a parametrized patch expression: create an anonymous function with the <a href="../api/#GModelFit.@fd"><code>@fd</code></a> macro with two arguments, the first has the same meaning as in the previous case, and the second is the free parameter value.  Note that patched parameter loses its original meaning, and becomes the parameter of the patch expression;</li><li>to define a patch constraint involving parameters from other models in a <a href="../multifit/#Multi-dataset-fitting">Multi-dataset fitting</a> scenario: simply use <code>mpatch</code> in place of <code>patch</code>, and the first argument to the λ-function will be a vector with as many elements as the number of models in the <code>Vector{Model}</code> object.</li></ol><p>The following examples show how to define constraints for each of the afore-mentioned cases.</p><h3 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h3><p>We will consider a model for a 1D domain consisting of the sum of a linear background component (named <code>bkg</code>) and two Gaussian-shaped features (<code>l1</code> and <code>l2</code>):</p><pre><code class="language-julia hljs">using GModelFit

model = Model(:bkg =&gt; GModelFit.OffsetSlope(1, 1, 0.1),
              :l1 =&gt; GModelFit.Gaussian(1, 2, 0.2),
              :l2 =&gt; GModelFit.Gaussian(1, 3, 0.4),
              :main =&gt; SumReducer(:bkg, :l1, :l2))</code></pre><p>Assume that, for the model to be meaningful, the parameters should satisfy the following constraints:</p><ul><li>the <code>bkg</code> should have a fixed value of 1 at <code>x</code>=1, and a slope which is in the range [0:0.2]:</li></ul><pre><code class="language-julia hljs">model[:bkg].offset.val = 1
model[:bkg].offset.fixed = true

model[:bkg].slope.low  = 0
model[:bkg].slope.high = 0.2</code></pre><ul><li>the normalization of <code>l1</code> and <code>l2</code> must be the same:</li></ul><pre><code class="language-julia hljs">model[:l2].norm.patch = :l1</code></pre><ul><li>the width of <code>l2</code> must be twice that of <code>l1</code> (patched parameter):</li></ul><pre><code class="language-julia hljs">model[:l2].sigma.patch = @fd m -&gt; 2 * m[:l1].sigma</code></pre><ul><li>the center of <code>l2</code> must be at a larger coordinate with respect to the center of <code>l1</code>.  In this case we re-interpret the <code>model[:l2].center</code> parameter as the distance between the two centers, and create a parametrized patch expression to calculate the actual center value of <code>l2</code>:</li></ul><pre><code class="language-julia hljs">model[:l2].center.patch = @fd (m, v) -&gt; v + m[:l1].center
model[:l2].center.val = 1   # guess value for the distance between the centers
model[:l2].center.low = 0   # ensure [l2].center &gt; [l1].center</code></pre><p>We can fit the model against a mock dataset (see <a href="../misc/#Generate-mock-datasets">Generate mock datasets</a>):</p><pre><code class="language-julia hljs">dom = Domain(0:0.1:5)
data = GModelFit.mock(Measures, model, dom)
bestfit, stats = fit(model, data)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(<span class="sgr32"><span class="sgr1">Components:
</span></span><span class="sgr1"><span class="sgr94">╭</span></span><span class="sgr94">───────────┬────────────────┬───────┬─────────────┬───────────┬───────────┬───────────┬─────────╮</span>
<span class="sgr94">│</span><span class="sgr94"><span class="sgr7"><span class="sgr1"> Component </span></span></span><span class="sgr94">│</span><span class="sgr94"><span class="sgr7"><span class="sgr1"> Type           </span></span></span><span class="sgr94">│</span><span class="sgr94"><span class="sgr7"><span class="sgr1"> #Free </span></span></span><span class="sgr94">│</span><span class="sgr94"><span class="sgr7"><span class="sgr1"> Eval. count </span></span></span><span class="sgr94">│</span><span class="sgr94"><span class="sgr7"><span class="sgr1"> Min       </span></span></span><span class="sgr94">│</span><span class="sgr94"><span class="sgr7"><span class="sgr1"> Max       </span></span></span><span class="sgr94">│</span><span class="sgr94"><span class="sgr7"><span class="sgr1"> Mean      </span></span></span><span class="sgr94">│</span><span class="sgr94"><span class="sgr7"><span class="sgr1"> NaN/Inf </span></span></span><span class="sgr94">│</span>
<span class="sgr94">├───────────┼────────────────┼───────┼─────────────┼───────────┼───────────┼───────────┼─────────┤</span>
<span class="sgr94">│</span> main      <span class="sgr94">│</span> SumReducer     <span class="sgr94">│</span>       <span class="sgr94">│</span> 111         <span class="sgr94">│</span>    0.8951 <span class="sgr94">│</span>     3.196 <span class="sgr94">│</span>     1.558 <span class="sgr94">│</span> 0       <span class="sgr94">│</span>
<span class="sgr94">│</span> ├─╴bkg    <span class="sgr94">│</span> OffsetSlope_1D <span class="sgr94">│</span> 1     <span class="sgr94">│</span> 36          <span class="sgr94">│</span>    0.8951 <span class="sgr94">│</span>     1.419 <span class="sgr94">│</span>     1.157 <span class="sgr94">│</span> 0       <span class="sgr94">│</span>
<span class="sgr94">│</span> ├─╴l1     <span class="sgr94">│</span> Gaussian_1D    <span class="sgr94">│</span> 3     <span class="sgr94">│</span> 72          <span class="sgr94">│</span> 1.088e-49 <span class="sgr94">│</span>      2.05 <span class="sgr94">│</span>    0.2004 <span class="sgr94">│</span> 0       <span class="sgr94">│</span>
<span class="sgr94">│</span> └─╴l2     <span class="sgr94">│</span> Gaussian_1D    <span class="sgr94">│</span> 1     <span class="sgr94">│</span> 82          <span class="sgr94">│</span>  3.91e-13 <span class="sgr94">│</span>     1.025 <span class="sgr94">│</span>    0.2004 <span class="sgr94">│</span> 0       <span class="sgr94">│</span>
<span class="sgr94">╰───────────┴────────────────┴───────┴─────────────┴───────────┴───────────┴───────────┴─────────╯</span>

<span class="sgr32"><span class="sgr1">Parameters:
</span></span><span class="sgr1"><span class="sgr94">╭</span></span><span class="sgr94">───────────┬────────────────┬────────┬──────────┬───────────┬───────────┬───────────┬─────────────────────────────╮</span>
<span class="sgr94">│</span><span class="sgr94"><span class="sgr7"><span class="sgr1"> Component </span></span></span><span class="sgr94">│</span><span class="sgr94"><span class="sgr7"><span class="sgr1"> Type           </span></span></span><span class="sgr94">│</span><span class="sgr94"><span class="sgr7"><span class="sgr1"> Param. </span></span></span><span class="sgr94">│</span><span class="sgr94"><span class="sgr7"><span class="sgr1"> Range    </span></span></span><span class="sgr94">│</span><span class="sgr94"><span class="sgr7"><span class="sgr1"> Value     </span></span></span><span class="sgr94">│</span><span class="sgr94"><span class="sgr7"><span class="sgr1"> Uncert.   </span></span></span><span class="sgr94">│</span><span class="sgr94"><span class="sgr7"><span class="sgr1"> Actual    </span></span></span><span class="sgr94">│</span><span class="sgr94"><span class="sgr7"><span class="sgr1"> Patch                       </span></span></span><span class="sgr94">│</span>
<span class="sgr94">├───────────┼────────────────┼────────┼──────────┼───────────┼───────────┼───────────┼─────────────────────────────┤</span>
<span class="sgr94">│</span><span class="sgr90"> bkg       </span><span class="sgr94">│</span><span class="sgr90"> OffsetSlope_1D </span><span class="sgr94">│</span><span class="sgr90"> offset </span><span class="sgr94">│</span><span class="sgr90"> -Inf:Inf </span><span class="sgr94">│</span><span class="sgr90">         1 </span><span class="sgr94">│</span><span class="sgr90">  (fixed)  </span><span class="sgr94">│</span><span class="sgr90">           </span><span class="sgr94">│</span><span class="sgr90">                             </span><span class="sgr94">│</span>
<span class="sgr94">│</span><span class="sgr90">           </span><span class="sgr94">│</span><span class="sgr90">                </span><span class="sgr94">│</span><span class="sgr90"> x0     </span><span class="sgr94">│</span><span class="sgr90"> -Inf:Inf </span><span class="sgr94">│</span><span class="sgr90">         1 </span><span class="sgr94">│</span><span class="sgr90">  (fixed)  </span><span class="sgr94">│</span><span class="sgr90">           </span><span class="sgr94">│</span><span class="sgr90">                             </span><span class="sgr94">│</span>
<span class="sgr94">│</span>           <span class="sgr94">│</span>                <span class="sgr94">│</span> slope  <span class="sgr94">│</span> 0:0.2    <span class="sgr94">│</span>    0.1049 <span class="sgr94">│</span>  0.009656 <span class="sgr94">│</span>           <span class="sgr94">│</span>                             <span class="sgr94">│</span>
<span class="sgr94">├───────────┼────────────────┼────────┼──────────┼───────────┼───────────┼───────────┼─────────────────────────────┤</span>
<span class="sgr94">│</span> l1        <span class="sgr94">│</span> Gaussian_1D    <span class="sgr94">│</span> norm   <span class="sgr94">│</span> 0:Inf    <span class="sgr94">│</span>     1.022 <span class="sgr94">│</span>   0.03548 <span class="sgr94">│</span>           <span class="sgr94">│</span>                             <span class="sgr94">│</span>
<span class="sgr94">│</span>           <span class="sgr94">│</span>                <span class="sgr94">│</span> center <span class="sgr94">│</span> -Inf:Inf <span class="sgr94">│</span>     2.004 <span class="sgr94">│</span>  0.009922 <span class="sgr94">│</span>           <span class="sgr94">│</span>                             <span class="sgr94">│</span>
<span class="sgr94">│</span>           <span class="sgr94">│</span>                <span class="sgr94">│</span> sigma  <span class="sgr94">│</span> 0:Inf    <span class="sgr94">│</span>    0.1989 <span class="sgr94">│</span>  0.007297 <span class="sgr94">│</span>           <span class="sgr94">│</span>                             <span class="sgr94">│</span>
<span class="sgr94">├───────────┼────────────────┼────────┼──────────┼───────────┼───────────┼───────────┼─────────────────────────────┤</span>
<span class="sgr94">│</span><span class="sgr90"> l2        </span><span class="sgr94">│</span><span class="sgr90"> Gaussian_1D    </span><span class="sgr94">│</span><span class="sgr90"> norm   </span><span class="sgr94">│</span><span class="sgr90"> 0:Inf    </span><span class="sgr94">│</span><span class="sgr90">         1 </span><span class="sgr94">│</span><span class="sgr90">  (fixed)  </span><span class="sgr94">│</span><span class="sgr90">     1.022 </span><span class="sgr94">│</span><span class="sgr90"> l1                          </span><span class="sgr94">│</span>
<span class="sgr94">│</span>           <span class="sgr94">│</span>                <span class="sgr94">│</span> center <span class="sgr94">│</span> 0:Inf    <span class="sgr94">│</span>     1.004 <span class="sgr94">│</span>   0.02822 <span class="sgr94">│</span>     3.008 <span class="sgr94">│</span> (m, v)-&gt;v + (m[:l1]).center <span class="sgr94">│</span>
<span class="sgr94">│</span><span class="sgr90">           </span><span class="sgr94">│</span><span class="sgr90">                </span><span class="sgr94">│</span><span class="sgr90"> sigma  </span><span class="sgr94">│</span><span class="sgr90"> 0:Inf    </span><span class="sgr94">│</span><span class="sgr90">       0.4 </span><span class="sgr94">│</span><span class="sgr90">  (fixed)  </span><span class="sgr94">│</span><span class="sgr90">    0.3978 </span><span class="sgr94">│</span><span class="sgr90"> m-&gt;2 * (m[:l1]).sigma       </span><span class="sgr94">│</span>
<span class="sgr94">╰───────────┴────────────────┴────────┴──────────┴───────────┴───────────┴───────────┴─────────────────────────────╯</span>
, <span class="sgr32"><span class="sgr1">Fit results:</span></span><span class="sgr1"> #data: 51, #free pars: 5, red. fit stat.:    0.95138, Status: <span class="sgr32">OK      </span>
)</span></code></pre><p>and plot the results with <a href="https://github.com/gcalderone/Gnuplot.jl">Gnuplot.jl</a>:</p><pre><code class="language-julia hljs">using Gnuplot
@gp    coords(dom) values(data) uncerts(data) &quot;w yerr t &#39;Data&#39;&quot; :-
@gp :- coords(dom) model(dom) &quot;w l t &#39;Model&#39;&quot;</code></pre><p><img src="../assets/example_patch1.png" alt/></p><p>See <a href="../multifit/#Multi-dataset-fitting">Multi-dataset fitting</a> for an example on how to create a patch epression involving multiple models.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../customcomp/">« Custom components</a><a class="docs-footer-nextpage" href="../multifit/">Multi-dataset fitting »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Saturday 16 March 2024 19:50">Saturday 16 March 2024</span>. Using Julia version 1.10.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
